# Bank Telegram Bot

Telegram bot для банковских услуг с AI-ответами и поддержкой модераторов.

## Основные возможности

- Регистрация пользователей с номером телефона
- AI-ответы на основе OpenAI API
- Векторный поиск по контексту с помощью FAISS
- Система поддержки модераторов
- Рассылка сообщений
- Логирование истории чатов
- Поддержка нескольких языков
- Асинхронная обработка задач
- Ролевое управление доступом (RBAC)
- Мониторинг и трассировка
- Облачное хранение данных
- Управление контекстом диалога

## Технические требования

- Python 3.8+
- Redis (для очередей задач)
- Jaeger (для трассировки)
- Prometheus (для мониторинга)
- AWS S3 (для облачного хранения)

## Установка

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd bank-bot
```

2. Создайте и активируйте виртуальное окружение:
```bash
python -m venv venv
source venv/bin/activate  # На Windows: venv\Scripts\activate
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

4. Создайте файл `.env`:
```bash
cp .env.example .env
```

5. Настройте `.env`:
```
BOT_TOKEN=ваш_токен_бота
OPENAI_API_KEY=ваш_ключ_OpenAI
REDIS_URL=redis://localhost:6379/0
CELERY_BROKER_URL=redis://localhost:6379/1
```

6. Создайте файл `context.txt` с контекстной информацией.

7. Запустите Redis:
```bash
redis-server
```

8. Запустите Celery worker:
```bash
celery -A services.queue_service worker --loglevel=info
```

9. Запустите бота:
```bash
python bot.py
```

## Команды

- `/start` - Начать регистрацию
- `/help` - Запросить помощь модератора
- `/end` - Завершить чат с модератором
- `/broadcast` (только для модераторов) - Отправить сообщение всем пользователям
- `/admin` (только для администраторов) - Панель администратора

## Структура проекта

```
├── bot.py                 # Основной файл инициализации и точка входа бота
├── config.py             # Настройки конфигурации
├── requirements.txt      # Зависимости проекта
├── .env.example         # Пример переменных окружения
├── contexts/            # Управление контекстом
│   ├── __init__.py
│   └── context_manager.py
├── database/            # Код для работы с базой данных
│   ├── __init__.py
│   ├── db.py           # Подключение и настройка базы данных
│   ├── models.py       # Модели базы данных
│   ├── queries.py      # Запросы к базе данных
│   └── rbac.py         # Контроль доступа на основе ролей
├── handlers/            # Обработчики сообщений и колбэков
│   ├── __init__.py
│   ├── moderator_handlers.py
│   └── user_handlers.py
├── middlewares/         # Компоненты промежуточного ПО
│   ├── __init__.py
│   └── auth_middleware.py
├── services/           # Интеграция с внешними сервисами
│   ├── __init__.py
│   ├── cloud_storage.py
│   ├── monitoring.py
│   ├── openai_service.py
│   ├── queue_service.py
│   └── vector_search.py
├── tasks/              # Фоновые задачи
│   ├── __init__.py
│   └── background_tasks.py
├── utils/             # Вспомогательные функции и утилиты
│   └── __init__.py
├── logs/              # Файлы логов
└── migrations/        # Миграции базы данных
```

## Мониторинг

- Prometheus метрики доступны на порту 9090
- Jaeger трассировка доступна на порту 16686
- Логи хранятся в директории logs/

## Безопасность

- Валидация и шифрование номеров телефонов
- Ролевое управление доступом
- API ключи в переменных окружения
- Аудит действий пользователей
- Rate limiting для защиты от спама

## Масштабируемость

- Асинхронная обработка задач через Celery
- Облачное хранение данных
- Распределенное логирование
- Поддержка кластеризации
